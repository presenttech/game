<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ Ù‚ÙŠØ¯ Ø§Ù„Ø­ÙŠØ§Ø©</title>
    <style>
        /* CSS Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: #fff;
            overflow: hidden;
            touch-action: manipulation;
            height: 100vh;
            display: flex;
            flex-direction: column;
            direction: rtl;
        }

        /* Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #login-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1a2a3a 0%, #0f1923 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            padding: 20px;
            transition: opacity 0.5s ease;
        }

        #login-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .game-title {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .input-group {
            width: 100%;
            max-width: 400px;
            margin-bottom: 1.5rem;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 30px;
            background-color: rgba(255,255,255,0.1);
            color: white;
            font-size: 1rem;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            background-color: rgba(255,255,255,0.2);
            box-shadow: 0 0 0 2px #4facfe;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 30px;
            background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
        #game-header {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background-color: rgba(0,0,0,0.5);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            flex-wrap: wrap;
        }

        .game-info {
            display: flex;
            align-items: center;
            margin: 5px 10px;
            font-size: 0.9rem;
        }

        .game-info span {
            margin-right: 5px;
            font-weight: bold;
            color: #4facfe;
        }

        /* Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© */
        #game-map {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #1a3a4a 0%, #0f1a23 100%);
            background-size: 200% 200%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Ø§Ù„Ù…Ù„Ø¬Ø£ */
        .shelter {
            position: absolute;
            width: 80px;
            height: 80px;
            background-color: #8B4513;
            border: 3px solid #A0522D;
            border-radius: 10px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(139, 69, 19, 0.5);
            transition: all 0.3s ease;
            z-index: 2;
        }

        .shelter::after {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 20px;
            background-color: #A0522D;
            clip-path: polygon(0% 100%, 50% 0%, 100% 100%);
        }

        /* Ø§Ù„Ù„Ø§Ø¹Ø¨ */
        .player {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.7);
            z-index: 3;
            transition: transform 0.1s ease;
        }

        .player::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 10px;
            background-color: rgba(0,0,0,0.3);
            border-radius: 50%;
        }

        /* Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ */
        .zombie {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50% 50% 45% 45%;
            background: linear-gradient(135deg, #7CFC00 0%, #228B22 100%);
            z-index: 3;
            animation: zombieFloat 2s ease-in-out infinite;
            transition: left 0.5s linear, top 0.5s linear;
        }

        @keyframes zombieFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .zombie::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 15px;
            height: 10px;
            background-color: rgba(0,0,0,0.3);
            border-radius: 50%;
        }

        .zombie::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 8px;
            background-color: rgba(0,0,0,0.2);
            border-radius: 50%;
        }

        /* Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ */
        .resource {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
            z-index: 1;
            animation: resourcePulse 2s ease-in-out infinite;
        }

        @keyframes resourcePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… */
        #game-controls {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background-color: rgba(0,0,0,0.5);
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .control-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .control-btn:active:not(:disabled) {
            transform: scale(0.95);
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù„ÙŠÙ„ ÙˆØ§Ù„Ù†Ù‡Ø§Ø± */
        .day-time {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .night-time {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
        }

        .night-time .shelter {
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.7);
        }

        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.8);
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            font-size: 1.5rem;
            text-align: center;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .game-message.show {
            opacity: 1;
        }

        /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù‡Ø§ØªÙ */
        #mobile-controls {
            display: none;
            position: absolute;
            bottom: 80px;
            width: 100%;
            justify-content: center;
            gap: 20px;
            z-index: 5;
        }

        .mobile-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.2);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.5rem;
            user-select: none;
            touch-action: manipulation;
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .game-title {
                font-size: 1.8rem;
            }
            
            .game-info {
                font-size: 0.8rem;
            }
            
            #mobile-controls {
                display: flex;
            }
            
            .control-btn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div id="app-container">
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div id="login-screen">
            <h1 class="game-title">Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ Ù‚ÙŠØ¯ Ø§Ù„Ø­ÙŠØ§Ø©</h1>
            <div class="input-group">
                <input type="text" id="player-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨" maxlength="15">
            </div>
            <button id="start-btn" class="btn">Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>

        <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div id="game-header">
            <div class="game-info">
                <span id="day-night-indicator">ğŸŒ Ø§Ù„Ù†Ù‡Ø§Ø±</span>
            </div>
            <div class="game-info">
                <span id="time-left">Ø§Ù„ÙˆÙ‚Øª: 120</span>
            </div>
            <div class="game-info">
                <span id="resources-counter">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯: 0</span>
            </div>
            <div class="game-info">
                <span id="shelter-health">Ø§Ù„Ù…Ù„Ø¬Ø£: 100%</span>
            </div>
            <div class="game-info">
                <span id="role-display">Ø§Ù„Ø¯ÙˆØ±: Ø¬Ø§Ù…Ø¹ Ù…ÙˆØ§Ø±Ø¯</span>
            </div>
        </div>

        <div id="game-map">
            <div id="shelter" class="shelter"></div>
            <div id="player" class="player"></div>
            <div id="zombies-container"></div>
            <div id="resources-container"></div>
            
            <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù‡Ø§ØªÙ -->
            <div id="mobile-controls">
                <div class="mobile-btn" id="mobile-up">â†‘</div>
                <div class="mobile-btn" id="mobile-left">â†</div>
                <div class="mobile-btn" id="mobile-right">â†’</div>
                <div class="mobile-btn" id="mobile-down">â†“</div>
            </div>
        </div>

        <div id="game-controls">
            <button id="build-btn" class="control-btn">ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ù„Ø¬Ø£ (10 Ù…ÙˆØ§Ø±Ø¯)</button>
            <button id="collect-btn" class="control-btn">Ø¬Ù…Ø¹ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯</button>
        </div>

        <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div id="game-message" class="game-message"></div>
    </div>

    <script>
        // Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        const gameState = {
            playerId: null,
            playerName: '',
            position: { x: 300, y: 300 },
            resources: 0,
            role: 'Ø¬Ø§Ù…Ø¹ Ù…ÙˆØ§Ø±Ø¯',
            zombies: [],
            resourcesList: [],
            gameData: {
                dayNightCycle: 'day',
                timeLeft: 120,
                shelterHealth: 100,
                shelterLevel: 1,
                wave: 0,
                gameOver: false
            },
            controls: {
                up: false,
                down: false,
                left: false,
                right: false
            },
            lastUpdate: 0,
            updateInterval: 50, // Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
            playerSpeed: 5,
            isCollecting: false,
            collectionRange: 50
        };

        // Ø¹Ù†Ø§ØµØ± DOM
        const elements = {
            loginScreen: document.getElementById('login-screen'),
            gameHeader: document.getElementById('game-header'),
            gameMap: document.getElementById('game-map'),
            shelter: document.getElementById('shelter'),
            player: document.getElementById('player'),
            zombiesContainer: document.getElementById('zombies-container'),
            resourcesContainer: document.getElementById('resources-container'),
            dayNightIndicator: document.getElementById('day-night-indicator'),
            timeLeft: document.getElementById('time-left'),
            resourcesCounter: document.getElementById('resources-counter'),
            shelterHealth: document.getElementById('shelter-health'),
            roleDisplay: document.getElementById('role-display'),
            buildBtn: document.getElementById('build-btn'),
            collectBtn: document.getElementById('collect-btn'),
            gameMessage: document.getElementById('game-message'),
            playerNameInput: document.getElementById('player-name'),
            startBtn: document.getElementById('start-btn'),
            mobileUp: document.getElementById('mobile-up'),
            mobileLeft: document.getElementById('mobile-left'),
            mobileRight: document.getElementById('mobile-right'),
            mobileDown: document.getElementById('mobile-down')
        };

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        function startGame() {
            gameState.playerName = elements.playerNameInput.value.trim() || 'Ù„Ø§Ø¹Ø¨' + Math.floor(Math.random() * 1000);
            
            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
            elements.loginScreen.classList.add('hidden');
            
            // ØªØ¹ÙŠÙŠÙ† Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹
            const roles = ['Ø¬Ø§Ù…Ø¹ Ù…ÙˆØ§Ø±Ø¯', 'Ø­Ø§Ø±Ø³', 'Ø¨Ù†Ø§Ø¡'];
            gameState.role = roles[Math.floor(Math.random() * roles.length)];
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±
            elements.roleDisplay.textContent = `Ø§Ù„Ø¯ÙˆØ±: ${gameState.role}`;
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
            setupEventListeners();
            setupGameLoop();
            
            // Ø¨Ø¯Ø¡ Ø¯ÙˆØ±Ø© Ø§Ù„Ù„ÙŠÙ„ ÙˆØ§Ù„Ù†Ù‡Ø§Ø±
            startDayNightCycle();
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ§Ø±Ø¯ Ø£ÙˆÙ„ÙŠØ©
            spawnInitialResources();
            
            // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙŠ
            updatePlayerPosition();
        }

        // ØªÙ‡ÙŠØ¦Ø© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            // Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            
            // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
            elements.buildBtn.addEventListener('click', upgradeShelter);
            elements.collectBtn.addEventListener('click', collectResources);
            
            // Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù‡Ø§ØªÙ
            elements.mobileUp.addEventListener('touchstart', () => gameState.controls.up = true);
            elements.mobileUp.addEventListener('touchend', () => gameState.controls.up = false);
            elements.mobileLeft.addEventListener('touchstart', () => gameState.controls.left = true);
            elements.mobileLeft.addEventListener('touchend', () => gameState.controls.left = false);
            elements.mobileRight.addEventListener('touchstart', () => gameState.controls.right = true);
            elements.mobileRight.addEventListener('touchend', () => gameState.controls.right = false);
            elements.mobileDown.addEventListener('touchstart', () => gameState.controls.down = true);
            elements.mobileDown.addEventListener('touchend', () => gameState.controls.down = false);
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            elements.startBtn.addEventListener('click', startGame);
            elements.playerNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') startGame();
            });
        }

        // Ø¯ÙˆØ±Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function setupGameLoop() {
            function gameLoop(timestamp) {
                if (!gameState.lastUpdate) gameState.lastUpdate = timestamp;
                const deltaTime = timestamp - gameState.lastUpdate;
                
                if (deltaTime >= gameState.updateInterval) {
                    updatePlayerPosition();
                    checkResourceCollection();
                    checkZombieCollisions();
                    moveZombies();
                    gameState.lastUpdate = timestamp;
                }
                
                if (!gameState.gameData.gameOver) {
                    requestAnimationFrame(gameLoop);
                }
            }
            
            requestAnimationFrame(gameLoop);
        }

        // Ø¯ÙˆØ±Ø© Ø§Ù„Ù„ÙŠÙ„ ÙˆØ§Ù„Ù†Ù‡Ø§Ø±
        function startDayNightCycle() {
            setInterval(() => {
                if (gameState.gameData.gameOver) return;
                
                // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
                gameState.gameData.timeLeft--;
                
                // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙŠÙ„ ÙˆØ§Ù„Ù†Ù‡Ø§Ø±
                if (gameState.gameData.timeLeft <= 0) {
                    if (gameState.gameData.dayNightCycle === 'day') {
                        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„ÙŠÙ„ ÙˆÙ…ÙˆØ¬Ø© Ø²ÙˆÙ…Ø¨ÙŠ Ø¬Ø¯ÙŠØ¯Ø©
                        gameState.gameData.dayNightCycle = 'night';
                        gameState.gameData.timeLeft = 60; // 60 Ø«Ø§Ù†ÙŠØ© Ù„ÙŠÙ„Ø§Ù‹
                        gameState.gameData.wave++;
                        
                        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ
                        spawnZombies(gameState.gameData.wave * 3);
                        
                        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø©
                        showMessage(`Ù…ÙˆØ¬Ø© Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ #${gameState.gameData.wave}!`, 3000);
                    } else {
                        // Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ù‡Ø§Ø±
                        gameState.gameData.dayNightCycle = 'day';
                        gameState.gameData.timeLeft = 120; // 120 Ø«Ø§Ù†ÙŠØ© Ù†Ù‡Ø§Ø±Ø§Ù‹
                        
                        // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ
                        gameState.zombies = [];
                        elements.zombiesContainer.innerHTML = '';
                        
                        // Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ§Ø±Ø¯ Ø¬Ø¯ÙŠØ¯Ø©
                        spawnResources(5);
                    }
                    
                    updateGameUI();
                }
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
                updateGameUI();
            }, 1000);
        }

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateGameUI() {
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„Ù„ÙŠÙ„ ÙˆØ§Ù„Ù†Ù‡Ø§Ø±
            if (gameState.gameData.dayNightCycle === 'day') {
                elements.dayNightIndicator.textContent = 'ğŸŒ Ø§Ù„Ù†Ù‡Ø§Ø±';
                elements.gameMap.classList.remove('night-time');
                elements.gameMap.classList.add('day-time');
            } else {
                elements.dayNightIndicator.textContent = 'ğŸŒš Ø§Ù„Ù„ÙŠÙ„';
                elements.gameMap.classList.remove('day-time');
                elements.gameMap.classList.add('night-time');
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
            elements.timeLeft.textContent = `Ø§Ù„ÙˆÙ‚Øª: ${gameState.gameData.timeLeft}`;
            
            // ØªØ­Ø¯ÙŠØ« ØµØ­Ø© Ø§Ù„Ù…Ù„Ø¬Ø£
            elements.shelterHealth.textContent = `Ø§Ù„Ù…Ù„Ø¬Ø£: ${gameState.gameData.shelterHealth}%`;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
            elements.resourcesCounter.textContent = `Ø§Ù„Ù…ÙˆØ§Ø±Ø¯: ${gameState.resources}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ØªØ­Ø³ÙŠÙ†
            elements.buildBtn.textContent = `ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ù„Ø¬Ø£ (${10 * gameState.gameData.shelterLevel} Ù…ÙˆØ§Ø±Ø¯)`;
            elements.buildBtn.disabled = gameState.resources < (10 * gameState.gameData.shelterLevel);
            
            // Ù‡Ø²Ø© Ø¹Ù†Ø¯ ØªØ¶Ø±Ø± Ø§Ù„Ù…Ù„Ø¬Ø£
            if (gameState.gameData.shelterHealth < 30) {
                elements.shelter.classList.add('shake');
                setTimeout(() => {
                    elements.shelter.classList.remove('shake');
                }, 500);
            }
            
            // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
            if (gameState.gameData.shelterHealth <= 0 && !gameState.gameData.gameOver) {
                gameState.gameData.gameOver = true;
                endGame();
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨
        function updatePlayerPosition() {
            if (!gameState.controls) return;
            
            let newX = gameState.position.x;
            let newY = gameState.position.y;
            
            if (gameState.controls.up) newY -= gameState.playerSpeed;
            if (gameState.controls.down) newY += gameState.playerSpeed;
            if (gameState.controls.left) newX -= gameState.playerSpeed;
            if (gameState.controls.right) newX += gameState.playerSpeed;
            
            // Ø§Ù„Ø­Ø¯ÙˆØ¯
            newX = Math.max(20, Math.min(newX, elements.gameMap.offsetWidth - 20));
            newY = Math.max(20, Math.min(newY, elements.gameMap.offsetHeight - 20));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹
            gameState.position = { x: newX, y: newY };
            elements.player.style.left = `${newX - 15}px`;
            elements.player.style.top = `${newY - 15}px`;
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ
        function spawnZombies(count) {
            const mapWidth = elements.gameMap.offsetWidth;
            const mapHeight = elements.gameMap.offsetHeight;
            
            for (let i = 0; i < count; i++) {
                let x, y;
                
                // ÙˆØ¶Ø¹ Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ Ø¹Ù„Ù‰ Ø­ÙˆØ§Ù Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                if (Math.random() < 0.5) {
                    x = Math.random() < 0.5 ? 0 : mapWidth;
                    y = Math.random() * mapHeight;
                } else {
                    x = Math.random() * mapWidth;
                    y = Math.random() < 0.5 ? 0 : mapHeight;
                }
                
                gameState.zombies.push({
                    id: 'zombie_' + Date.now() + '_' + i,
                    position: { x, y },
                    speed: 1 + Math.random(),
                    health: 3
                });
            }
            
            updateZombiesOnScreen();
        }

        // Ø­Ø±ÙƒØ© Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ
        function moveZombies() {
            if (gameState.gameData.dayNightCycle !== 'night') return;
            
            const shelterPos = {
                x: elements.shelter.offsetLeft + elements.shelter.offsetWidth / 2,
                y: elements.shelter.offsetTop + elements.shelter.offsetHeight / 2
            };
            
            gameState.zombies.forEach(zombie => {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù†Ø­Ùˆ Ø§Ù„Ù…Ù„Ø¬Ø£
                const dx = shelterPos.x - zombie.position.x;
                const dy = shelterPos.y - zombie.position.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 10) {
                    const newX = zombie.position.x + (dx / distance) * zombie.speed;
                    const newY = zombie.position.y + (dy / distance) * zombie.speed;
                    
                    zombie.position = { x: newX, y: newY };
                }
            });
            
            updateZombiesOnScreen();
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©
        function updateZombiesOnScreen() {
            elements.zombiesContainer.innerHTML = '';
            
            gameState.zombies.forEach(zombie => {
                const zombieElement = document.createElement('div');
                zombieElement.className = 'zombie';
                zombieElement.style.left = `${zombie.position.x - 15}px`;
                zombieElement.style.top = `${zombie.position.y - 15}px`;
                zombieElement.id = zombie.id;
                elements.zombiesContainer.appendChild(zombieElement);
            });
        }

        // ØªÙˆÙ„ÙŠØ¯ Ù…ÙˆØ§Ø±Ø¯ Ø£ÙˆÙ„ÙŠØ©
        function spawnInitialResources() {
            spawnResources(10);
        }

        // ØªÙˆÙ„ÙŠØ¯ Ù…ÙˆØ§Ø±Ø¯
        function spawnResources(count) {
            const mapWidth = elements.gameMap.offsetWidth;
            const mapHeight = elements.gameMap.offsetHeight;
            
            for (let i = 0; i < count; i++) {
                gameState.resourcesList.push({
                    id: 'resource_' + Date.now() + '_' + i,
                    position: { 
                        x: 50 + Math.random() * (mapWidth - 100),
                        y: 50 + Math.random() * (mapHeight - 100)
                    },
                    value: 1
                });
            }
            
            updateResourcesOnScreen();
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©
        function updateResourcesOnScreen() {
            elements.resourcesContainer.innerHTML = '';
            
            gameState.resourcesList.forEach(resource => {
                const resourceElement = document.createElement('div');
                resourceElement.className = 'resource';
                resourceElement.style.left = `${resource.position.x - 10}px`;
                resourceElement.style.top = `${resource.position.y - 10}px`;
                resourceElement.id = resource.id;
                elements.resourcesContainer.appendChild(resourceElement);
            });
        }

        // Ø¬Ù…Ø¹ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
        function collectResources() {
            if (gameState.isCollecting) return;
            gameState.isCollecting = true;
            
            let collected = false;
            
            for (let i = 0; i < gameState.resourcesList.length; i++) {
                const resource = gameState.resourcesList[i];
                const distance = getDistance(gameState.position, resource.position);
                
                if (distance < gameState.collectionRange) {
                    // Ø²ÙŠØ§Ø¯Ø© Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨
                    gameState.resources += resource.value;
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ±Ø¯
                    gameState.resourcesList.splice(i, 1);
                    
                    // ØªØ£Ø«ÙŠØ± Ù…Ø±Ø¦ÙŠ
                    const resourceElement = document.getElementById(resource.id);
                    if (resourceElement) {
                        resourceElement.style.transform = 'scale(1.5)';
                        resourceElement.style.opacity = '0';
                        setTimeout(() => {
                            resourceElement.remove();
                        }, 300);
                    }
                    
                    collected = true;
                    break;
                }
            }
            
            if (collected) {
                elements.player.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    elements.player.style.transform = 'scale(1)';
                }, 200);
                updateGameUI();
            } else {
                showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø±Ø¯ Ù‚Ø±ÙŠØ¨Ø©!', 1000);
            }
            
            setTimeout(() => {
                gameState.isCollecting = false;
            }, 500);
        }

        // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ù„Ø¬Ø£
        function upgradeShelter() {
            const requiredResources = 10 * gameState.gameData.shelterLevel;
            
            if (gameState.resources >= requiredResources) {
                // Ø®ØµÙ… Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
                gameState.resources -= requiredResources;
                
                // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ù„Ø¬Ø£
                gameState.gameData.shelterHealth = Math.min(100, gameState.gameData.shelterHealth + 20);
                gameState.gameData.shelterLevel++;
                
                // ØªØ£Ø«ÙŠØ± Ù…Ø±Ø¦ÙŠ
                elements.shelter.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    elements.shelter.style.transform = 'scale(1)';
                }, 300);
                
                showMessage('ØªÙ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ù„Ø¬Ø£!', 1500);
                updateGameUI();
            } else {
                showMessage('Ù…ÙˆØ§Ø±Ø¯ ØºÙŠØ± ÙƒØ§ÙÙŠØ©!', 1000);
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØµØ§Ø¯Ù…Ø§Øª Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ
        function checkZombieCollisions() {
            if (gameState.gameData.dayNightCycle !== 'night') return;
            
            const shelterPos = {
                x: elements.shelter.offsetLeft + elements.shelter.offsetWidth / 2,
                y: elements.shelter.offsetTop + elements.shelter.offsetHeight / 2
            };
            
            for (let i = 0; i < gameState.zombies.length; i++) {
                const zombie = gameState.zombies[i];
                const distance = getDistance(zombie.position, shelterPos);
                
                if (distance < 50) {
                    // Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ ÙŠÙ‡Ø§Ø¬Ù… Ø§Ù„Ù…Ù„Ø¬Ø£
                    gameState.gameData.shelterHealth = Math.max(0, gameState.gameData.shelterHealth - 1);
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ Ø¥Ø°Ø§ ÙˆØµÙ„ Ù„Ù„Ù…Ù„Ø¬Ø£
                    if (distance < 30) {
                        gameState.zombies.splice(i, 1);
                        i--;
                    }
                    
                    updateGameUI();
                }
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù…Ø¹ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
        function checkResourceCollection() {
            if (!gameState.isCollecting) return;
            
            for (let i = 0; i < gameState.resourcesList.length; i++) {
                const resource = gameState.resourcesList[i];
                const distance = getDistance(gameState.position, resource.position);
                
                if (distance < gameState.collectionRange) {
                    collectResources();
                    break;
                }
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¶ØºØ·Ø§Øª Ø§Ù„Ù…ÙØ§ØªÙŠØ­
        function handleKeyDown(e) {
            switch(e.key) {
                case 'ArrowUp':
                case 'w':
                    gameState.controls.up = true;
                    break;
                case 'ArrowDown':
                case 's':
                    gameState.controls.down = true;
                    break;
                case 'ArrowLeft':
                case 'a':
                    gameState.controls.left = true;
                    break;
                case 'ArrowRight':
                case 'd':
                    gameState.controls.right = true;
                    break;
            }
        }

        function handleKeyUp(e) {
            switch(e.key) {
                case 'ArrowUp':
                case 'w':
                    gameState.controls.up = false;
                    break;
                case 'ArrowDown':
                case 's':
                    gameState.controls.down = false;
                    break;
                case 'ArrowLeft':
                case 'a':
                    gameState.controls.left = false;
                    break;
                case 'ArrowRight':
                case 'd':
                    gameState.controls.right = false;
                    break;
            }
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ù†Ù‚Ø·ØªÙŠÙ†
        function getDistance(pos1, pos2) {
            const dx = pos1.x - pos2.x;
            const dy = pos1.y - pos2.y;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø©
        function showMessage(message, duration = 2000) {
            elements.gameMessage.textContent = message;
            elements.gameMessage.classList.add('show');
            
            if (duration > 0) {
                setTimeout(() => {
                    elements.gameMessage.classList.remove('show');
                }, duration);
            }
        }

        // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        function endGame() {
            gameState.gameData.gameOver = true;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
            const survivedWaves = gameState.gameData.wave;
            
            showMessage(`Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! Ù†Ø¬ÙˆØª Ù…Ù† ${survivedWaves} Ù…ÙˆØ¬Ø§Øª ÙˆØ¬Ù…Ø¹Øª ${gameState.resources} Ù…ÙˆØ§Ø±Ø¯`, 5000);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†
            setTimeout(() => {
                resetGame();
            }, 5000);
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
        function resetGame() {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            gameState.position = { x: 300, y: 300 };
            gameState.resources = 0;
            gameState.zombies = [];
            gameState.resourcesList = [];
            gameState.gameData = {
                dayNightCycle: 'day',
                timeLeft: 120,
                shelterHealth: 100,
                shelterLevel: 1,
                wave: 0,
                gameOver: false
            };
            
            // Ù…Ø³Ø­ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
            elements.zombiesContainer.innerHTML = '';
            elements.resourcesContainer.innerHTML = '';
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
            elements.loginScreen.classList.remove('hidden');
            elements.playerNameInput.value = gameState.playerName;
            
            // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨
            updatePlayerPosition();
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
        });
    </script>
</body>
</html>
